[supervisord]
logfile=/tmp/supervisord.log
loglevel=info
pidfile=/tmp/supervisord.pid
nodaemon=true
user=worker

[unix_http_server]
file = /tmp/supervisor.sock
chmod = 0777

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

[supervisorctl]
serverurl=unix:///tmp/supervisor.sock

[program:app]
command=uwsgi --ini /app/conf/uwsgi.ini:docker
redirect_stderr=true
stdout_logfile=/data/logs/app_bsmserver.log
priority=1
startsecs=5
stopwaitsecs=5

[program:consul]
command=consul-template --config=/app/conf/consul.hcl
redirect_stderr=true
stdout_logfile=/data/logs/consul_bsmserver.log
priority=2
startsecs=5
stopwaitsecs=3

[program:celery]
command=celery worker  -A business_manager -l info
directory=/app/src
redirect_stderr=true
stdout_logfile=/data/logs/celery_businessserver.log
priority=3
startsecs=5
stopwaitsecs=5

[eventlistener:docekrevent]
command=/app/bin/kill_supervisor.py
events=PROCESS_STATE_FATAL
